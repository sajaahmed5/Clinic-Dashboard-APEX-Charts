<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clinic Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: #e0e7ff; /* Background color similar to your image */
        }
        .chart-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            padding: 150px;
            background-color: #e0e7ff;
        }
        .chart-box {
            width: 32%;
            margin-bottom: 30px;
            position: relative;
        }
        .chart {
            width: 100%;
            height: 300px; /* Adjust height if needed */
        }
        h1 {
            text-align: center;
            margin-top: 30px;
            color: #1a1a1a;
        }
        #logo {
            position: absolute;
            top: 30px; /* Adjust according to chart position */
            left: 5%;
            transform: translateX(-50%);
            z-index: 1;
        }
        #logo img {
            width: 150px;
        }
    </style>
</head>
<body>

    <h1>Clinic Dashboard</h1>

    <div id="logo">
        <img src="C:\Users\sajaa\OneDrive\Desktop\SIRGAD\SIRGAD_logo.png" alt="SIRGAD Logo"> <!-- Add path to logo image -->
    </div>

    <!-- Chart Containers -->
    <div class="chart-container">
        <div class="chart-box">
            <div id="chart1" class="chart"></div>
        </div>
        <div class="chart-box">
            <div id="chart2" class="chart"></div>
        </div>
        <div class="chart-box">
            <div id="chart3" class="chart"></div>
        </div>
    </div>

    <script>
    // Fetch data from the API
    fetch('http://localhost:3000/chart-data')
    .then(response => response.json())
    .then(data => {
        console.log("Fetched data:", data);

        // Chart 1 - Based on `chart1` dataset (from chart_4_1)
        if (data.chart1 && data.chart1.length > 0) {
            const chart1Categories = data.chart1.map(item => item.year_);
            const chart1Values = data.chart1.map(item => item.sumAmount);

            const options1 = {
                chart: { type: 'line' },
                series: [{ name: 'Sum of Amount', data: chart1Values }],
                xaxis: { categories: chart1Categories },
                title: { text: 'Total revenue for each year', align: 'center' },
                colors: ['#1E90FF'], // Line color
                stroke: {
                    curve: 'smooth'
                },
                yaxis: {
                    labels: {
                        formatter: val => Math.floor(val).toLocaleString() // Format large numbers
                    }
                }
            };
            const chart1 = new ApexCharts(document.querySelector("#chart1"), options1);
            chart1.render();
        } else {
            console.error("Chart 1 data is missing or empty.");
        }

        // Chart 2 - Based on `chart2` dataset (from chart_4_2)
        if (data.chart2 && data.chart2.length > 0) {
            const chart2Categories = data.chart2.map(item => item.year_);
            const chart2Values = data.chart2.map(item => item.CountZerosAmounts);

            const options2 = {
                chart: { type: 'bar' },
                series: [{ name: 'Value', data: chart2Values }],
                xaxis: { categories: chart2Categories },
                title: { text: 'Number of unpaid procedures per year', align: 'center' },
                colors: ['#1E90FF'], // Bar color
                dataLabels: {
                    enabled: false
                },
                yaxis: {
                    labels: {
                        formatter: val => Math.floor(val).toLocaleString()
                    }
                }
            };
            const chart2 = new ApexCharts(document.querySelector("#chart2"), options2);
            chart2.render();
        } else {
            console.error("Chart 2 data is missing or empty.");
        }

        // Chart 3 - Multi-series Clustered Column Chart (from chart_4_3)
        if (data.chart3 && data.chart3.length > 0) {
            const chart3Categories = [...new Set(data.chart3.map(item => item.year_))]; // Get unique years
            const procedures = ['Consultation', 'Contrôle', 'Extraction', 'Opération', 'Orthodotntie', 'Prothèse', 'Soins'];

            const seriesData = procedures.map(procedure => {
                return {
                    name: procedure,
                    data: chart3Categories.map(year => {
                        const record = data.chart3.find(item => item.year_ === year && item.ProcedureName === procedure);
                        return record ? record['Count_of_acte_id_max_per_name'] : 0;
                    })
                };
            });

            const options3 = {
                chart: { type: 'bar' },
                series: seriesData,
                xaxis: {
                    categories: chart3Categories,
                    title: { text: 'Year' }
                },
                yaxis: {
                    logarithmic: true, // Set y-axis to logarithmic scale
                    min: 1,
                    max: 10000,
                    title: { text: 'Count of Occurring Procedures each Year' }
                },
                plotOptions: {
                    bar: {
                        horizontal: false,
                        columnWidth: '55%',
                        endingShape: 'flat'
                    }
                },
                title: { text: 'Count of Occurring Procedures Each Year', align: 'center' },
                colors: ['#C0C0C0', '#7B68EE', '#00BFFF', '#FFD700', '#FF69B4', '#808080', '#1E90FF'],
                dataLabels: { enabled: false }
            };
            const chart3 = new ApexCharts(document.querySelector("#chart3"), options3);
            chart3.render();
        } else {
            console.error("Chart 3 data is missing or empty.");
        }
    })
    .catch(err => {
        console.error("Error fetching chart data:", err);
    });
    </script>
</body>
</html>
